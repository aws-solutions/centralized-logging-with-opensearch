# 费用预估

!!! Important "重要"

    本节中描述的成本估算只是示例，它们是根据假设计算的，可能会因您的环境而异。


您需要承担运行解决方案时使用亚马逊云科技各个服务的成本费用。 截至2022年10月，影响解决方案成本的主要因素包括：

- 要摄取的日志类型
- 要摄取/处理的日志量
- 日志消息的大小
- 日志的位置
- 额外的特性

以下示例将演示 10/100/1000 GB 每日日志摄取的成本估算。 总成本由 [**Amazon OpenSearch 费用**](#amazon-opensearch)、[**处理费用**](#_1) 和 [**额外特性费用**](#_4)。


!!! Note "信息"

    所有成本估算均基于亚马逊云科技北佛吉尼亚区域 (us-east-1) 中的 AWS 服务价格。


## Amazon OpenSearch 费用

- **OD**: 按需实例价格模型
- **AURI_1**: 全额预付1年预留实例
- **分层**：存储在层中的天数。 例如，7H + 23W + 60C 表示日志在热层存储 7 天，温层存储 23 天，冷层存储 60 天。
- **副本**: 分片副本的数量。

| 每日日志量 (GB)	 | 存储 (天)	 | 分层	              | 副本	 | OD 每月 ($)	 | AURI_1 每月  ($)	 | 专用主节点	        | 数据节点	           | EBS (GB)	 | UltraWarm 节点	 | UltraWarm/Cold S3 存储 (GB)	 | OD 每GB费用 ($)	 | AURI_1 每GB费用 ($)	 |
|-------------|---------|------------------|-----|------------|-----------------|---------------|-----------------|--------------------------|---------------|----------------------------|---------------|-------------------|
| 10	         | 30	     | 30H	             | 0	  | 216.28	    | 158.54	         | N/A	          | c6g.large[2]	   | 380	      | N/A	          | 0	                         | 0.72093	      | 0.52847	          |
| 10	         | 30	     | 30H	             | 1	  | 289.35	    | 223.94	         | N/A	          | m6g.large[2]	   | 760	      | N/A	          | 0	                         | 0.9645	       | 0.74647	          |
| 100	        | 30	     | 7H + 23W	        | 0	  | 989.49	    | 825.97	         | m6g.large[3]	 | m6g.large[2]	   | 886	      | medium[2]	    | 0	                         | 0.32983	      | 0.27532	          |
| 100	        | 30	     | 7H + 23W	        | 1	  | 1295.85	   | 1066.92	        | m6g.large[3]	 | m6g.large[4]	   | 1772	     | medium[2]	    | 0	                         | 0.43195	      | 0.35564	          |
| 100	        | 90	     | 7H + 23W + 60C	  | 0	  | 1133.49	   | 969.97	         | m6g.large[3]	 | m6g.large[2]	   | 886	      | medium[2]	    | 8300	                      | 0.12594	      | 0.10777	          |
| 100	        | 90	     | 7H + 23W + 60C	  | 1	  | 1439.85	   | 1210.92	        | m6g.large[3]	 | m6g.large[4]	   | 1772	     | medium[2]	    | 8300	                      | 0.15998	      | 0.13455	          |
| 100	        | 180	    | 7H + 23W + 150C	 | 0	  | 1349.49	   | 1185.97	        | m6g.large[3]	 | m6g.large[2]	   | 886	      | medium[2]	    | 17300	                     | 0.07497	      | 0.06589	          |
| 100	        | 180	    | 7H + 23W + 150C	 | 1	  | 1655.85	   | 1426.92	        | m6g.large[3]	 | m6g.large[4]	   | 1772	     | medium[2]	    | 17300	                     | 0.09199	      | 0.07927	          |
| 1000	       | 30	     | 7H + 23W	        | 0	  | 6101.15	   | 5489.48	        | m6g.large[3]	 | r6g.xlarge[6]	  | 8856	     | medium[15]	   | 23000	                     | 0.20337	      | 0.18298	          |
| 1000	       | 30	     | 7H + 23W	        | 1	  | 8759.49	   | 7635.8	         | m6g.large[3]	 | r6g.2xlarge[6]	 | 17712	    | medium[15]	   | 23000	                     | 0.29198	      | 0.25453	          |
| 1000	       | 90	     | 7H + 23W + 60C	  | 0	  | 8027.33	   | 7245.45	        | m6g.large[3]	 | r6g.xlarge[6]	  | 8856	     | medium[15]	   | 83000	                     | 0.08919	      | 0.0805	           |
| 1000	       | 90	     | 7H + 23W + 60C	  | 1	  | 10199.49	  | 9075.8	         | m6g.large[3]	 | r6g.2xlarge[6]	 | 17712	    | medium[15]	   | 83000	                     | 0.11333	      | 0.10084	          |
| 1000	       | 180	    | 7H + 23W + 150C	 | 0	  | 9701.15	   | 9089.48	        | m6g.large[3]	 | r6g.xlarge[6]	  | 8856	     | medium[15]	   | 173000	                    | 0.0539	       | 0.0505	           |
| 1000	       | 180	    | 7H + 23W + 150C	 | 1	  | 12644.19	  | 11420.86	       | m6g.large[3]	 | r6g.2xlarge[6]	 | 17712	    | medium[15]	   | 173000	                    | 0.07025	      | 0.06345	          |

## 处理费用

### AWS 服务日志

摄取和处理服务日志的成本可能会根据日志位置等情况而有所不同。

### Amazon S3 中的日志

!!! note "信息"

    从 S3 提取 AWS 服务日志会产生非常低的 SQS 和 S3 请求费用，通常在 AWS 免费套餐内。

以下是假设：

- AWS 服务每 5 分钟以 gzip 格式将日志保存到 Amazon S3（大多数 AWS 服务以 gzip 格式输出日志）。
- S3 中 4MB 的压缩日志文件的原始日志大小约为 100MB。
- 一个 1GB 内存的 Lambda 处理一个 4MB 的日志文件大约需要 26 秒，即每 MB 原始日志需要 260 毫秒
- 最大压缩日志文件大小为 5MB。

您每天有 `N` GB 原始日志，每日成本估算如下：

- Lambda 成本 = 每 MB 260 毫秒 x 1024 MB x `N` GB/天 x 每毫秒 0.0000000167 美元
- S3 存储成本 = 每 GB 0.023 美元 x `N` GB/天 * 4%（压缩）

处理 AWS 服务日志的每月总成本为：

**每月总成本** =（Lambda 成本 + S3 存储成本）x 30 天

| 每次日志量 | 每日 Lambda 费用 ($) | 每次 S3 存储费用 ($) | 每月费用 ($) |
|-------|------------------|----------------|----------|
| 10    | 0.044            | 0.009          | 1.610    |
| 100   | 0.445            | 0.092          | 16.099   |
| 1000  | 4.446            | 0.920          | 160.986  |


### 应用日志

摄取和处理应用程序日志的成本可能会根据日志位置等情况而有所不同。

#### 从 Amazon EC2 收集日志

!!! important "重要"

    如果您有多种日志格式（索引），则需要对每种格式进行成本估算。

成本估算基于以下假设和事实：

- 平均日志消息大小为 1 KB。
- Lambda 内存为 1024 MB。
- 每个 Lambda 调用处理 1 MB 日志。
- 一次 Lambda 调用处理一个 Kinesis 分片，Lambda 可以扩展来并发以处理多个分片。
- 处理小于 5 MB 的日志的 Lambda 运行时为 500 毫秒。
- 一个 Kinesis 分片摄入日志大小为 = 1 MB/秒 x 3600 秒/小时 x 24 小时 x 0.7 = 60.48 GB/天。
- 提供 30% 以上的额外分片来处理流量抖动。
- 每日日志量为 `X` GB。
- 所需的 Kinesis 分片数 `S` 为 = Round_up_to_next_integer（每日日志量 `X`/ 60.48）。

基于以上假设，以下是每日成本估算公式：

- Kinesis 分片小时成本 = 0.015 美元/分片小时 x 每天 24 小时 x `S` 分片
- Kinesis PUT 有效负载单位成本 = 每百万单位 0.014 美元 * 每 GB 1 百万 x `X` GB 每天
- Lambda 成本 = 每 1 毫秒 0.0000000167 美元 x 每次调用 500 毫秒 x 每 GB 1,000 次调用 x `X` GB 每天

**每月总成本** =（Kinesis Shard 小时成本 + Kinesis PUT 有效负载单位成本 + Lambda 成本）x 30 天

| 每次日志量 (GB) | 分片数 | 每日 Kinesis 分片小时费 | 每日 Kinesis PUT 有效负载费用 | 每次 Lambda 费用 | 每月总费用 ($) |
|------------|-----|------------------|-----------------------|--------------|-----------|
| 10         | 1   | 0.36             | 0.14                  | 0.0835       | 17.505    |
| 100        | 2   | 0.72             | 1.4                   | 0.835        | 88.65     |
| 1000       | 17  | 6.12             | 14                    | 8.35         | 854.1     |

#### 从 Amazon EKS 提取日志

目前，EKS 和 Amazon OpenSearch 之间没有缓冲层，也没有额外的费用。

## 额外特性费用

!!! Note "信息"

     如果您选择不使用 Log Hub 控制台中的附加功能，则不会向您收费。

### 访问代理

如果通过 Log Hub 部署并创建了[访问代理](./domains/proxy.md)，将收取以下费用。

- EC2 成本 = t3.large 1Y 全部预付预留实例 $426.612 x 2 / 12 个月 = $71.1/月
- EBS 成本 = 0.1 GB/月 x 8 GB x 2 = $1.6/月
- 弹性负载均衡器成本 = 每 ALB 小时 $0.0225 x 720 小时/月 = $16.2/月

**每月总费用** = 71.1 美元 EC2 成本 + 1.6 美元 EBS 成本 + 16.2 美元弹性负载均衡器成本 = **88.9 美元**

### 告警

如果通过 Log Hub 部署并创建了[告警](./domains/alarms.md)，可参考[CloudWatch 价格](https://aws.amazon.com/cloudwatch/pricing/)。